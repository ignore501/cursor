# Kaggle Learning Progress Telegram Bot - Документация для разработчиков

## Содержание
1. [Архитектура проекта](#архитектура-проекта)
2. [Компоненты системы](#компоненты-системы)
3. [Безопасность](#безопасность)
4. [Разработка](#разработка)
5. [Тестирование](#тестирование)
6. [Развертывание](#развертывание)
7. [Мониторинг](#мониторинг)

## Архитектура проекта

### Структура директорий
```
.
├── scripts/               # Исходный код
│   ├── autopost.py       # Основной модуль бота
│   ├── post_templates.py # Генерация постов
│   ├── jupyter_parser.py # Парсинг ноутбуков
│   └── moderator.py      # Модерация и безопасность
├── data/                 # Данные и шаблоны
│   ├── notebooks/        # Jupyter ноутбуки
│   ├── templates/        # Шаблоны постов
│   └── plan.json        # План обучения
├── logs/                # Логи
├── .github/            # CI/CD конфигурация
└── config.py           # Конфигурация проекта
```

### Технологический стек
- Python 3.11
- python-telegram-bot 20.7
- Hugging Face Transformers
- MLflow
- Jinja2
- Docker
- GitHub Actions

## Компоненты системы

### 1. Основной модуль (autopost.py)
- Инициализация и настройка бота
- Обработка команд
- Планировщик постов
- Интеграция с MLflow

### 2. Генерация постов (post_templates.py)
- Шаблоны утренних/вечерних постов
- Интеграция с BART для суммаризации
- Управление планом обучения

### 3. Парсинг ноутбуков (jupyter_parser.py)
- Извлечение метрик
- Парсинг кода
- Обработка графиков
- Генерация описаний

### 4. Модерация (moderator.py)
- Проверка сообщений
- Анти-спам система
- Управление пользователями
- Статистика активности

## Безопасность

### Меры защиты
1. Модерация сообщений:
   - Проверка на спам
   - Фильтрация запрещенных слов
   - Ограничение частоты сообщений

2. Управление доступом:
   - Система предупреждений
   - Автоматическая блокировка
   - Административные команды

3. Защита данных:
   - Безопасное хранение токенов
   - Валидация входных данных
   - Логирование действий

## Разработка

### Настройка окружения
```bash
# Создание виртуального окружения
python -m venv venv
source venv/bin/activate  # Linux/Mac
.\venv\Scripts\activate   # Windows

# Установка зависимостей
pip install -r requirements.txt
```

### Переменные окружения
Создайте файл `.env`:
```env
TELEGRAM_BOT_TOKEN=your_bot_token
CHANNEL_ID=your_channel_id
MLFLOW_TRACKING_URI=http://localhost:5000
```

### Стиль кода
- PEP 8
- Docstrings в формате Google
- Типизация (type hints)
- Логирование

## Тестирование

### Модульные тесты
```bash
pytest tests/
```

### Интеграционные тесты
```bash
pytest tests/integration/
```

### Линтинг
```bash
flake8 scripts/
black scripts/
isort scripts/
```

## Развертывание

### Docker
```bash
# Сборка образа
docker build -t kaggle-learning-bot .

# Запуск контейнера
docker run -d --env-file .env kaggle-learning-bot
```

### GitHub Actions
- Автоматическая сборка
- Тестирование
- Развертывание

## Мониторинг

### Логи
- Файл: `logs/bot.log`
- Формат: `%(asctime)s - %(name)s - %(levelname)s - %(message)s`

### Метрики
- MLflow для отслеживания экспериментов
- Статистика пользователей
- Метрики производительности

## Расширение функциональности

### Добавление новых команд
1. Создать метод в классе `KaggleLearningBot`
2. Зарегистрировать обработчик в `__init__`
3. Добавить документацию в `help_command`

### Добавление новых шаблонов
1. Создать шаблон в `data/templates/`
2. Добавить метод генерации в `PostGenerator`
3. Обновить конфигурацию

### Интеграция новых моделей
1. Добавить модель в `requirements.txt`
2. Создать класс-обертку
3. Интегрировать в существующий код

## Устранение неполадок

### Частые проблемы
1. Ошибки аутентификации
   - Проверить токены
   - Проверить права доступа

2. Проблемы с MLflow
   - Проверить подключение
   - Проверить формат метрик

3. Ошибки парсинга
   - Проверить формат ноутбуков
   - Проверить регулярные выражения

### Отладка
1. Включить подробное логирование
2. Проверить конфигурацию
3. Использовать try-except с логированием 