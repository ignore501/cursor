# Скрипты управления базой данных

Этот набор скриптов предназначен для управления базой данных бота.

## Доступные скрипты

### 1. Миграция базы данных (`db_migrate.py`)

Используется для обновления структуры базы данных без потери данных.

```bash
python scripts/db_migrate.py
```

Особенности:
- Создает резервную копию перед изменениями
- Проверяет существующие таблицы
- Добавляет новые колонки, если необходимо
- Создает новые индексы
- Восстанавливает из резервной копии в случае ошибки

### 2. Сброс базы данных (`db_reset.py`)

Используется для полного сброса и пересоздания базы данных.

```bash
# Без тестовых данных
python scripts/db_reset.py

# С тестовыми данными
ADD_TEST_DATA=true python scripts/db_reset.py
```

Особенности:
- Создает резервную копию перед удалением
- Удаляет существующую базу данных
- Создает новую базу данных с актуальной схемой
- Опционально добавляет тестовые данные
- Требует подтверждения перед выполнением

### 3. Проверка базы данных (`db_check.py`)

Используется для проверки структуры базы данных.

```bash
python scripts/db_check.py
```

Проверяет:
- Наличие всех необходимых таблиц
- Структуру каждой таблицы (колонки и их типы)
- Наличие индексов
- Количество записей в таблицах

### 4. Просмотр данных (`db_view.py`)

Используется для просмотра содержимого таблиц.

```bash
python scripts/db_view.py
```

Особенности:
- Отображает данные в удобном табличном формате
- Показывает количество записей в каждой таблице
- Пропускает системные таблицы

## Структура базы данных

База данных содержит следующие таблицы:

1. `users` - информация о пользователях
   - user_id (INTEGER PRIMARY KEY)
   - username (TEXT)
   - first_name (TEXT)
   - last_name (TEXT)
   - created_at (TIMESTAMP)
   - last_active (TIMESTAMP)

2. `messages` - сообщения пользователей
   - message_id (INTEGER PRIMARY KEY)
   - user_id (INTEGER)
   - content (TEXT)
   - created_at (TIMESTAMP)

3. `competitions` - соревнования
   - id (INTEGER PRIMARY KEY)
   - competition_id (TEXT UNIQUE)
   - title (TEXT)
   - description (TEXT)
   - created_at (TIMESTAMP)
   - status (TEXT)
   - last_updated (TIMESTAMP)

4. `topics` - темы для голосования
   - topic_id (INTEGER PRIMARY KEY)
   - title (TEXT)
   - description (TEXT)
   - created_at (TIMESTAMP)
   - created_by (INTEGER)
   - competition_id (TEXT)

5. `votes` - голоса пользователей
   - vote_id (INTEGER PRIMARY KEY)
   - topic_id (INTEGER)
   - user_id (INTEGER)
   - vote_type (INTEGER)
   - created_at (TIMESTAMP)

## Рекомендации по использованию

1. Перед внесением изменений в структуру базы данных:
   - Создайте резервную копию
   - Используйте `db_migrate.py` для обновления структуры

2. При необходимости полного сброса:
   - Убедитесь, что у вас есть резервная копия важных данных
   - Используйте `db_reset.py`

3. Для проверки состояния базы данных:
   - Используйте `db_check.py` для проверки структуры
   - Используйте `db_view.py` для просмотра данных

4. При добавлении новых таблиц или колонок:
   - Обновите документацию
   - Добавьте соответствующие миграции в `db_migrate.py`
   - Обновите тестовые данные в `db_reset.py` 