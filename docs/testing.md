# Документация по тестированию

## Запуск тестов

Для запуска тестов используйте команду:
```sh
python -m pytest --asyncio-mode=auto tests/test_database.py -v
```

Флаг `--asyncio-mode=auto` необходим для корректной работы асинхронных тестов.

## Структура тестов базы данных

### Фикстуры

1. `db_sync` - синхронная фикстура для создания тестовой базы данных в памяти
2. `db_async` - асинхронная фикстура для создания тестовой базы данных в файле

### Тесты

1. `test_add_user` - проверка добавления пользователя
   - Создает пользователя с заданными параметрами
   - Проверяет корректность сохранения в базе данных

2. `test_add_message` - проверка добавления сообщения
   - Создает пользователя
   - Добавляет сообщение
   - Проверяет корректность сохранения в базе данных

3. `test_block_and_unblock_user` - проверка блокировки/разблокировки пользователя
   - Создает пользователя
   - Блокирует пользователя
   - Проверяет статус блокировки
   - Разблокирует пользователя
   - Проверяет статус разблокировки

4. `test_increment_warnings` - проверка увеличения счетчика предупреждений
   - Создает пользователя
   - Увеличивает счетчик предупреждений
   - Проверяет новое значение счетчика

5. `test_get_topics_and_add_vote` - проверка работы с темами и голосами
   - Создает пользователя
   - Создает тему
   - Проверяет получение списка тем
   - Добавляет голос
   - Проверяет корректность сохранения голоса

## Типы данных

В тестах используются следующие типы данных:

```python
class UserRecord(TypedDict):
    username: str
    first_name: str
    last_name: str
    id: int

class MessageRecord(TypedDict):
    user_id: int
    message_text: str
    id: int

class UserStatsRecord(TypedDict):
    username: str
    first_name: str
    last_name: str
    created_at: str

class TopicRecord(TypedDict):
    id: int
    title: str
    votes: int
```

## Зависимости

Для запуска тестов необходимы следующие пакеты:
- pytest
- pytest-asyncio
- aiosqlite

## Примечания

1. Тесты используют временную базу данных SQLite
2. После каждого теста база данных очищается
3. Все асинхронные операции выполняются через `aiosqlite`
4. Для проверки результатов используются прямые SQL-запросы к базе данных 